<!-- Navbar -->
<nav class="fixed inset-x-0 top-0 z-40">
    <div class="relative">
        <div class="absolute inset-0 bg-white/80 backdrop-blur-xl shadow-[0_10px_40px_rgba(48,34,21,0.12)]"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="relative flex items-center justify-between py-4">
                <a href="/" class="flex items-center gap-3" title="LangAmore">
                    <span class="relative inline-flex items-center justify-center w-14 h-14 rounded-full bg-white border border-white/70 shadow-[0_18px_45px_rgba(139,93,55,0.15)] overflow-hidden">
                        <img src="/images/logo.jpg" alt="LangAmore" class="w-12 h-12 object-contain" />
                    </span>
                    <div class="flex flex-col">
                        <span class="text-lg font-semibold text-[var(--color-primary-dark)] tracking-wide">LangAmore</span>
                        <span class="text-sm uppercase tracking-[0.3em] text-[var(--color-muted)]">Guest House</span>
                    </div>
                </a>

                <div class="hidden lg:flex items-center gap-8 text-sm font-semibold">
                    <a href="/" class="text-[var(--color-muted)] hover:text-[var(--color-primary)] transition-colors" title="Home">Home</a>
                    <a href="/about" class="text-[var(--color-muted)] hover:text-[var(--color-primary)] transition-colors" title="Chi siamo">Noi</a>
                    <a href="/services" class="text-[var(--color-muted)] hover:text-[var(--color-primary)] transition-colors" title="Servizi">Servizi</a>
                    <div class="relative" data-dropdown>
                        <button
                            class="inline-flex items-center gap-1 text-[var(--color-muted)] hover:text-[var(--color-primary)] transition-colors"
                            data-dropdown-trigger
                            type="button"
                            title="La struttura"
                        >
                            La struttura
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                            </svg>
                        </button>
                        <div
                            class="dropdown-panel absolute right-0 mt-3 hidden min-w-[220px] rounded-2xl bg-white/95 shadow-[0_22px_40px_rgba(48,34,21,0.12)] border border-white/70 overflow-hidden"
                            data-dropdown-panel
                        >
                            <a href="/bedroom" class="block px-5 py-3 text-sm text-[var(--color-muted)] hover:bg-[rgba(139,93,55,0.08)]" title="Le camere">Le camere</a>
                            <a href="/tourist-location" class="block px-5 py-3 text-sm text-[var(--color-muted)] hover:bg-[rgba(139,93,55,0.08)]" title="Locazione turistica">Locazione turistica</a>
                        </div>
                    </div>
                    <a href="/contact" class="text-[var(--color-muted)] hover:text-[var(--color-primary)] transition-colors" title="Contatti">Contatti</a>
                </div>

                <div class="hidden lg:flex items-center gap-3">
                    <a href="/contact#richiesta" class="btn btn-outline" title="Richiedi disponibilità">Richiedi disponibilità</a>
                    <a
                        href="https://www.booking.com/hotel/it/langamore-guest-house.it.html"
                        class="btn btn-primary"
                        target="_blank"
                        rel="noopener"
                        title="Prenota LangAmore"
                    >Prenota ora</a>
                </div>
                <button
                    class="inline-flex h-12 w-12 items-center justify-center rounded-full border border-white/60 bg-white/70 shadow-[0_12px_24px_rgba(48,34,21,0.12)] text-[var(--color-primary-dark)] transition hover:bg-white lg:hidden"
                    id="mobile-nav-toggle"
                    type="button"
                    aria-expanded="false"
                    aria-controls="mobile-nav"
                    aria-label="Apri il menu"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.5 6.75h15m-15 5.25h15m-15 5.25h15" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div
        id="mobile-nav"
        class="mobile-nav lg:hidden fixed inset-x-0 top-[78px] bg-white/95 backdrop-blur-xl shadow-[0_18px_40px_rgba(48,34,21,0.14)] transition-transform duration-200 ease-out"
        data-open="false"
    >
        <div class="px-5 py-6 space-y-4 text-base font-semibold text-[var(--color-muted)]">
            <a href="/" class="block hover:text-[var(--color-primary)]" title="Home">Home</a>
            <a href="/about" class="block hover:text-[var(--color-primary)]" title="Chi siamo">Noi</a>
            <a href="/services" class="block hover:text-[var(--color-primary)]" title="Servizi">Servizi</a>
            <details class="group">
                <summary class="flex cursor-pointer list-none items-center justify-between">
                    <span>La struttura</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                    </svg>
                </summary>
                <div class="mt-3 space-y-2 pl-4 text-sm">
                    <a href="/bedroom" class="block hover:text-[var(--color-primary)]" title="Le camere">Le camere</a>
                    <a href="/tourist-location" class="block hover:text-[var(--color-primary)]" title="Locazione turistica">Locazione turistica</a>
                </div>
            </details>
            <a href="/contact" class="block hover:text-[var(--color-primary)]" title="Contatti">Contatti</a>
            <div class="pt-4 border-t border-white/60 flex flex-col gap-3">
                <a href="/contact#richiesta" class="btn btn-outline w-full justify-center" title="Richiedi disponibilità">Richiedi disponibilità</a>
                <a
                    href="https://www.booking.com/hotel/it/langamore-guest-house.it.html"
                    class="btn btn-primary w-full justify-center"
                    target="_blank"
                    rel="noopener"
                    title="Prenota LangAmore"
                >Prenota ora</a>
            </div>
        </div>
    </div>
</nav>

<script is:inline>
    const initHeaderInteractions = () => {
        const mobileToggle = document.getElementById("mobile-nav-toggle");
        const mobileNav = document.getElementById("mobile-nav");

        const setMenuState = (isOpen) => {
            if (!mobileNav || !mobileToggle) return;
            mobileNav.dataset.open = String(isOpen);
            mobileToggle.setAttribute("aria-expanded", String(isOpen));
            document.body.classList.toggle("menu-open", isOpen);
        };

        if (mobileToggle && mobileNav) {
            setMenuState(false);

            mobileToggle.addEventListener("click", (event) => {
                event.stopPropagation();
                const currentlyOpen = mobileNav.dataset.open === "true";
                setMenuState(!currentlyOpen);
            });

            mobileNav.addEventListener("click", (event) => {
                const target = event.target;
                if (target instanceof HTMLAnchorElement) {
                    setMenuState(false);
                }
            });

            document.addEventListener("click", (event) => {
                if (mobileNav.dataset.open !== "true") return;
                const target = event.target;
                if (!(target instanceof Node)) return;
                if (!mobileNav.contains(target) && !mobileToggle.contains(target)) {
                    setMenuState(false);
                }
            });

            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape" && mobileNav.dataset.open === "true") {
                    setMenuState(false);
                }
            });

            const lgMediaQuery = window.matchMedia("(min-width: 1024px)");
            const handleBreakpoint = (event) => {
                if (event.matches) {
                    setMenuState(false);
                }
            };

            if (typeof lgMediaQuery.addEventListener === "function") {
                lgMediaQuery.addEventListener("change", handleBreakpoint);
            } else if (typeof lgMediaQuery.addListener === "function") {
                lgMediaQuery.addListener(handleBreakpoint);
            }
        }

        const dropdowns = document.querySelectorAll('[data-dropdown]');

        dropdowns.forEach((dropdown) => {
            const trigger = dropdown.querySelector('[data-dropdown-trigger]');
            const panel = dropdown.querySelector('[data-dropdown-panel]');

            if (!trigger || !panel) return;

            const openPanel = () => panel.classList.remove("hidden");
            const closePanel = () => panel.classList.add("hidden");

            trigger.addEventListener("mouseenter", openPanel);
            trigger.addEventListener("focus", openPanel);
            dropdown.addEventListener("mouseleave", closePanel);
            trigger.addEventListener("blur", closePanel);
        });
    };

    if (typeof window !== "undefined") {
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initHeaderInteractions, { once: true });
        } else {
            initHeaderInteractions();
        }
    }
</script>
